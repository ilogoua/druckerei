<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Склад полиграфии — песочница</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 24px; background: #0b0f19; color: #e8eefc; }
    .wrap { max-width: 980px; margin: 0 auto; }
    h1 { margin: 0 0 12px; font-size: 22px; }
    .card { background: #121a2a; border: 1px solid #22304d; border-radius: 14px; padding: 16px; box-shadow: 0 8px 30px rgba(0,0,0,.25); }
    table { width: 100%; border-collapse: collapse; margin-top: 12px; }
    th, td { text-align: left; padding: 10px 8px; border-bottom: 1px solid #22304d; }
    th { font-size: 12px; color: #a9b7d6; text-transform: uppercase; letter-spacing: .06em; }
    .pill { display: inline-block; padding: 4px 10px; border-radius: 999px; font-size: 12px; }
    .ok { background: rgba(0,200,120,.15); border: 1px solid rgba(0,200,120,.35); }
    .low { background: rgba(255,170,0,.12); border: 1px solid rgba(255,170,0,.35); }
    .danger { background: rgba(255,60,80,.12); border: 1px solid rgba(255,60,80,.35); }
    .row { display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 10px; margin-top: 14px; }
    input, button {
      border-radius: 12px; border: 1px solid #22304d; background: #0f1626; color: #e8eefc;
      padding: 10px 12px; font-size: 14px; outline: none;
    }
    input:focus { border-color: #3a5aa6; }
    button { cursor: pointer; background: #1a2750; }
    button:hover { filter: brightness(1.1); }
    .actions { display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap; }
    .msg { margin-top: 12px; font-size: 14px; color: #cfe1ff; }
    .hint { color: #a9b7d6; font-size: 13px; margin-top: 6px; }
    .small { font-size: 12px; color: #a9b7d6; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Склад полиграфии — песочница</h1>

    <div class="card">
      <div class="small">Выдача/приём меняют склад. Статус “Нужно заказать” включается автоматически, когда quantity &lt; minLevel.</div>

      <table>
        <thead>
          <tr>
            <th>Расходник</th>
            <th>Количество</th>
            <th>Min level</th>
            <th>Статус</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>

      <div class="row">
        <input id="nameInput" placeholder='Название (например: Бумага A1)' />
        <input id="amountInput" type="number" min="1" step="1" placeholder="Кол-во" />
        <input id="minInput" type="number" min="0" step="1" placeholder="Min (для добавления)" />
        <button id="addBtn">Добавить</button>
      </div>

      <div class="actions">
        <button id="issueBtn">Выдать в цех</button>
        <button id="receiveBtn">Принять на склад</button>
        <button id="checkBtn">Проверка склада</button>
        <button id="resetBtn">Сброс</button>
      </div>

      <div class="msg" id="msg"></div>
      <div class="hint">Подсказка: название должно совпадать ровно (в этой версии). Потом сделаем поиск “по похожести”.</div>
    </div>
  </div>

  <script>
    // ====== Данные (состояние) ======
    const initialWarehouse = [
      { name: "Бумага A1", quantity: 500, minLevel: 100 },
      { name: "Краска CYAN", quantity: 20, minLevel: 10 },
      { name: "Плёнка", quantity: 5, minLevel: 15 }
    ];

    let warehouse = structuredClone(initialWarehouse);

    // ====== Утилиты UI ======
    const $ = (id) => document.getElementById(id);

    function setMsg(text) {
      $("msg").textContent = text;
    }

    function statusFor(item) {
      if (item.quantity < 0) return { text: "Ошибка", cls: "danger" };
      if (item.quantity < item.minLevel) return { text: "Нужно заказать", cls: "low" };
      return { text: "ОК", cls: "ok" };
    }

    function render() {
      const tbody = $("tbody");
      tbody.innerHTML = "";

      for (let i = 0; i < warehouse.length; i++) {
        const item = warehouse[i];
        const s = statusFor(item);

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${item.name}</td>
          <td>${item.quantity}</td>
          <td>${item.minLevel}</td>
          <td><span class="pill ${s.cls}">${s.text}</span></td>
        `;
        tbody.appendChild(tr);
      }
    }

    // ====== Логика склада ======
    function findItemByName(name) {
      for (let i = 0; i < warehouse.length; i++) {
        if (warehouse[i].name === name) return warehouse[i];
      }
      return null;
    }

    function issue(name, amount) {
      const item = findItemByName(name);
      if (!item) return `Товар "${name}" не найден.`;

      if (amount <= 0 || Number.isNaN(amount)) return "Количество должно быть числом > 0.";
      if (item.quantity < amount) return `Недостаточно "${name}" на складе. Сейчас: ${item.quantity}.`;

      item.quantity -= amount;

      if (item.quantity < item.minLevel) {
        return `"${name}" выдано: ${amount}. Остаток: ${item.quantity}. Нужно заказать!`;
      }
      return `"${name}" выдано: ${amount}. Остаток: ${item.quantity}.`;
    }

    function receive(name, amount) {
      const item = findItemByName(name);
      if (!item) return `Товар "${name}" не найден.`;

      if (amount <= 0 || Number.isNaN(amount)) return "Количество должно быть числом > 0.";
      item.quantity += amount;

      return `"${name}" принято: ${amount}. Остаток: ${item.quantity}.`;
    }

    function addNewItem(name, amount, minLevel) {
      if (!name) return "Введите название.";
      if (findItemByName(name)) return `Товар "${name}" уже существует.`;

      if (amount < 0 || Number.isNaN(amount)) return "Начальное количество должно быть числом >= 0.";
      if (minLevel < 0 || Number.isNaN(minLevel)) return "Min level должен быть числом >= 0.";

      warehouse.push({ name, quantity: amount, minLevel });
      return `Добавлено: "${name}" (кол-во ${amount}, min ${minLevel}).`;
    }

    function checkAll() {
      let msg = "";
      for (let i = 0; i < warehouse.length; i++) {
        if (warehouse[i].quantity < warehouse[i].minLevel) {
          msg += `${warehouse[i].name} — нужно заказать. `;
        }
      }
      return msg || "Всё ок: ниже минимума ничего нет.";
    }

    // ====== События кнопок ======
    function readForm() {
      const name = $("nameInput").value.trim();
      const amount = Number($("amountInput").value);
      const min = Number($("minInput").value);
      return { name, amount, min };
    }

    $("issueBtn").addEventListener("click", () => {
      const { name, amount } = readForm();
      const result = issue(name, amount);
      setMsg(result);
      render();
    });

    $("receiveBtn").addEventListener("click", () => {
      const { name, amount } = readForm();
      const result = receive(name, amount);
      setMsg(result);
      render();
    });

    $("addBtn").addEventListener("click", () => {
      const { name, amount, min } = readForm();
      const result = addNewItem(name, Number.isNaN(amount) ? 0 : amount, Number.isNaN(min) ? 0 : min);
      setMsg(result);
      render();
    });

    $("checkBtn").addEventListener("click", () => {
      setMsg(checkAll());
      render();
    });

    $("resetBtn").addEventListener("click", () => {
      warehouse = structuredClone(initialWarehouse);
      setMsg("Склад сброшен к исходному состоянию.");
      render();
    });

    // Первый рендер
    render();
    setMsg("Готово. Выбери расходник, введи количество и жми кнопку.");
  </script>
</body>
</html>
